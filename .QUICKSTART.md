# Quick Start Guide

Get Angel Archive running locally in ~15 minutes.

## Prerequisites

- **Python 3.11+** (check: `python --version`)
- **Node.js 18+** (check: `node --version`)
- **Supabase account** (free tier at [supabase.com](https://supabase.com))

## Setup Steps

### 1. Create Supabase Project (2 minutes)

1. Go to [supabase.com](https://supabase.com) and sign in
2. Click **"New Project"**
3. Enter details:
   - **Name**: `angel-archive`
   - **Database Password**: Choose strong password (save it!)
   - **Region**: Closest to you
4. Wait ~2 minutes for provisioning

### 2. Get API Credentials (1 minute)

In Supabase Dashboard:
1. Go to **Project Settings** (gear icon) â†’ **API**
2. Copy these values:
   - **Project URL**: `https://xxxxx.supabase.co`
   - **anon public key**: `eyJhbGci...`
   - **service_role secret key**: `eyJhbGci...` (keep secret!)

### 3. Set Up Database Schema (2 minutes)

1. In Supabase Dashboard, go to **SQL Editor**
2. Click **"New Query"**
3. Copy entire contents of `backend/database/schema.sql`
4. Paste and click **"Run"**

This creates 6 tables: `series`, `angels`, `users`, `user_collections`, `audit_logs`, `job_runs`

### 4. Create Supabase Storage Bucket (1 minute)

1. In Supabase Dashboard, go to **Storage**
2. Click **"New Bucket"**
3. Name: `angels`
4. Make it **Public** (toggle on)
5. Click **Create**

### 5. Configure Backend Environment (2 minutes)

```bash
cd backend
cp .env.example .env
```

Edit `backend/.env`:

```bash
# Supabase (from Step 2)
SUPABASE_URL=https://your-project-id.supabase.co
SUPABASE_KEY=your_anon_public_key
SUPABASE_SERVICE_KEY=your_service_role_secret_key

# Storage
STATIC_ASSETS_URL=https://your-project-id.supabase.co/storage/v1/object/public
BUCKET_NAME=angels

# Optional (leave as-is for now)
REDIS_URL=redis://localhost:6379

# Development settings
NODE_ENV=development
DISABLE_RATE_LIMIT=true
PORT=8000

# Cron (disabled by default)
CRON_ENABLED=false
CRON_SCHEDULE=0 2 * * 0

# Image Service
IMAGE_SERVICE_URL=http://localhost:8001
IMAGE_OPACITY_VALUE=0.5
```

### 6. Configure Frontend Environment (1 minute)

```bash
cd frontend
cp .env.example .env
```

Edit `frontend/.env`:

```bash
VITE_SUPABASE_URL=https://your-project-id.supabase.co
VITE_SUPABASE_KEY=your_anon_public_key
VITE_API_BASE_URL=http://localhost:8000
```

### 7. Install Dependencies (3 minutes)

```bash
# Backend
cd backend
pip install -r requirements.txt

# Frontend
cd ../frontend
npm install

# Image Service (optional)
cd ../image-service
pip install -r requirements.txt

# Scraper (optional, for fetching new images)
cd ../scraper
pip install -r requirements.txt
```

### 8. Start Services

Open 3 terminal windows:

**Terminal 1 - Backend (FastAPI):**
```bash
cd backend
uvicorn app.main:app --reload --port 8000
```

**Terminal 2 - Frontend (Vite):**
```bash
cd frontend
npm run dev
```

**Terminal 3 - Image Service (optional):**
```bash
cd image-service
python main.py
```

### 9. Verify Setup

**Test Backend:**
```bash
curl http://localhost:8000/health
# Should return: {"status":"healthy","timestamp":"..."}

curl http://localhost:8000/health/ready
# Should return: {"status":"ready","database":"connected",...}
```

**Test Frontend:**
Open http://localhost:5173 in browser

**Test Image Service (if running):**
```bash
curl http://localhost:8001/health
# Should return: {"status":"ok","service":"image-processing",...}
```

## ðŸŽ‰ You're Done!

### Access Points
| Service | URL |
|---------|-----|
| Frontend | http://localhost:5173 |
| Backend API | http://localhost:8000 |
| API Docs (Swagger) | http://localhost:8000/docs |
| Image Service | http://localhost:8001 |
| Supabase Dashboard | https://supabase.com/dashboard |

---

## Optional: Seed Database with Angels

If you want to populate the database with angel data:

### Option A: Use the Scraper (10-15 minutes)

```bash
cd scraper

# Step 1: Discover all series from Sonny Angel website
python discover_galleries.py
# Creates gallery_config.json with 100+ series

# Step 2: Download images
python scrape_images.py
# Downloads to scraper/images/

# Step 3: Process images (creates grayscale, opacity, circular variants)
python process_images.py
```

Then you'll need to upload to Supabase Storage and seed the database (scripts needed).

### Option B: Manual Seeding

Insert test data directly via Supabase Dashboard â†’ Table Editor.

---

## Optional: Enable Redis Caching

```bash
# macOS
brew install redis
brew services start redis

# Linux
sudo apt install redis-server
sudo systemctl start redis

# Verify
redis-cli ping
# Should return: PONG
```

Then uncomment `REDIS_URL` in `backend/.env`:
```bash
REDIS_URL=redis://localhost:6379
```

Restart the backend.

---

## Optional: Enable Automated Jobs

Edit `backend/.env`:
```bash
CRON_ENABLED=true
CRON_SCHEDULE=0 2 * * 0  # Weekly on Sunday at 2am
```

Restart backend. Jobs will run automatically.

**Manual trigger:**
```bash
curl -X POST http://localhost:8000/api/jobs/trigger
```

---

## Troubleshooting

### "supabaseUrl is required"
- Check `backend/.env` has correct `SUPABASE_URL` and `SUPABASE_KEY`

### "Connection refused" on API calls
- Make sure backend is running on port 8000
- Check `frontend/.env` has `VITE_API_BASE_URL=http://localhost:8000`

### Images not loading
- Verify Supabase Storage bucket `angels` exists and is public
- Check `STATIC_ASSETS_URL` and `BUCKET_NAME` in backend `.env`

### Port already in use
```bash
# Find what's using the port
lsof -i :8000

# Kill it
kill -9 <PID>
```

### Database errors
- Run `backend/database/schema.sql` in Supabase SQL Editor again
- Check Supabase Dashboard â†’ Table Editor to verify tables exist

---

## Running Tests

```bash
# Backend tests
cd backend
pytest -v

# Image service tests
cd image-service
pytest test_main.py -v
```

---

## Next Steps

1. **Explore the API**: Visit http://localhost:8000/docs for interactive API documentation
2. **Sign up**: Create an account through the frontend
3. **Browse angels**: View the catalog (once seeded)
4. **Manage collections**: Add angels to your collection, favorites, wishlist
5. **Export data**: Test the JSON/CSV export from your profile page

---

## Development Tips

- **Hot reload**: Both frontend (Vite) and backend (uvicorn --reload) auto-reload on changes
- **API docs**: FastAPI auto-generates Swagger UI at `/docs` and ReDoc at `/redoc`
- **Rate limiting disabled**: In dev mode with `DISABLE_RATE_LIMIT=true`
- **Logs**: Backend logs to console, watch for errors

